"use strict";fetch(chrome.extension.getURL("/index.html")).then(function(r){return r.text()}).then(function(html){var _a;var originalData=document.createElement("div");originalData.id="originalData";originalData.style.display="none";originalData.innerHTML=((_a=document.querySelector("td[align=center]"))===null||_a===void 0?void 0:_a.innerHTML)||document.body.innerHTML;document.getElementsByTagName("html")[0].innerHTML=html;document.body.appendChild(originalData);var vuescript=document.createElement("script");vuescript.setAttribute("src","https://cdn.jsdelivr.net/npm/vue/dist/vue.js");vuescript.setAttribute("onload","init()");document.body.appendChild(vuescript);var vueapp=document.createElement("script");vueapp.innerHTML='\n      var app;\n\n      function init() {\n        app = new Vue({\n          el: "#app",\n          created: function() {\n            var originalData = document.getElementById("originalData");\n            this.parseHTML(originalData.innerHTML);\n            originalData.parentNode.removeChild(originalData)\n            this.pep_call = (new URLSearchParams(location.search)).get("pep_call");\n          },\n          data: {\n            currentCursor: 10,\n            subjects: [],\n            subjectSearch: "",\n            filterSearchText: "",\n            pep_call: ""\n          },\n          methods: {\n            parseHTML: function(htmlString) {\n              var parser = new DOMParser();\n              var htmlDoc = parser.parseFromString(htmlString, "text/html");\n              var _a, _b, _c, _d, _e, _f, _g, _h;\n\n              // Get Data\n              var data_element = htmlDoc.querySelector("table[border=\'1\']");\n              var subjects_string =\n                (_a = data_element) === null || _a === void 0 ? void 0 : _a.innerText;\n              var subject_link_nodelist = htmlDoc.querySelectorAll("table[border=\'1\'] a");\n              var subject_link_array = [];\n              for (\n                var i = -1, l = subject_link_nodelist.length;\n                ++i !== l;\n                subject_link_array[i] = subject_link_nodelist[i]\n              );\n              var subjects_link = subject_link_array.map(function(link) {\n                return link.href;\n              });\n              // TESTING\n              var formatted_subjects_string = subjects_string.replace(/\\s+/g," ").replace(/Number ปี/g,"Number - ปี").trim();\n              var matcher = /\\d+\\s*รหัสวิขา\\s*(.+?)\\s*ชื่อวิชา\\s*(.+?)\\s*Call Number\\s*(.+?)\\s*ปีการศีกษา\\s*(.+?)\\s*ภาคเรียน\\s*(.+?)\\s*ข้อสอบ\\s*(.+?)\\s*/g;\n              var matches = [...formatted_subjects_string.matchAll(matcher)];\n              function subjectSorter(a, b) {\n                const Term = type => (type === "Mid-Term" ? 0 : 0.01);\n                let a_score = a.s_year + a.s_term * 0.1 + Term(a.s_type);\n                let b_score = b.s_year + b.s_term * 0.1 + Term(b.s_type);\n                return b_score - a_score;\n              }\n              this.subjects = (this.subjects || []).concat(matches.map(function(e,index){return (\n                {\n                  s_id: e[1],\n                  s_name: e[2],\n                  s_cnum: e[3],\n                  s_year: +e[4],\n                  s_term: +e[5],\n                  s_type: {"F":"Final","M":"Mid-Term"}[e[6]],\n                  s_link: subjects_link[index]\n                }\n              )})).sort(subjectSorter);\n            },\n            fetchData: function(){\n              var pep_call_params = this.pep_call || "";\n              fetch("https://modps5.lib.kmutt.ac.th/services/research/specialdbs/pep.jsp?pep_call="+pep_call_params+"&offset="+this.currentCursor)\n                .then(e => e.text())\n                .then(e => this.parseHTML(e));\n              this.currentCursor += 10;\n            },\n            searchSubject: function(){\n              if(this.subjectSearch.trim === "") return;\n              this.pep_call = encodeURIComponent(this.subjectSearch);\n              fetch("https://modps5.lib.kmutt.ac.th/services/research/specialdbs/pep.jsp?pep_call="+this.pep_call)\n                .then(e => e.text())\n                .then(e => {\n                  this.currentCursor = 10;\n                  this.subjects = [];\n                  this.parseHTML(e);\n                });\n            }\n          }\n        });\n      }\n    ';document.body.appendChild(vueapp)});